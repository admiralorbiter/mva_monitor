{% extends "base.html" %}

{% block title %}View MVA Data{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/table.css') }}">
{% endblock %}

{% block content %}
<h1>MVA Data</h1>

<!-- Search and Filter Form -->
<form method="get" action="{{ url_for('view_mva_data') }}" class="mb-4">
    <div class="form-row align-items-end">
        <div class="form-group col-md-4 col-lg-3">
            <label for="full_name">Full Name</label>
            <input type="text" class="form-control" id="full_name" name="full_name" placeholder="Enter full name" value="{{ request.args.get('full_name', '') }}">
        </div>
        <div class="form-group col-md-4 col-lg-3">
            <label for="school_name">School Name</label>
            <select class="form-control" id="school_name" name="school_name">
                <option value="">Select a School</option>
                {% for school in schools %}
                <option value="{{ school.school_name }}" {% if school.school_name == request.args.get('school_name', '') %}selected{% endif %}>
                    {{ school.school_name }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group col-md-4 col-lg-2">
            <button type="submit" class="btn btn-primary btn-block">Search</button>
        </div>
    </div>
</form>

<table class="table">
    <thead>
        <tr>
            <th>State ID</th>
            <th>School Name</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Grade Year</th>
            <th>MVA Progress</th>
        </tr>
    </thead>
    <tbody>
        {% for mva in mva_records.items %}
        <tr>
            <td>{{ mva.student.state_id }}</td>
            <td>{{ mva.student.school.school_name }}</td>
            <td>{{ mva.student.first_name }}</td>
            <td>{{ mva.student.last_name }}</td>
            <td>{{ mva.student.grade_year }}</td>
            <td>
                {% if 'completed' in mva.description %}
                    <i class="fas fa-check-circle icon-green" title="{{ mva.description }}"></i> 
                    {{ mva.description }}
                {% elif 'working on CTE' in mva.description %}
                    <i class="fas fa-exclamation-circle icon-yellow" title="{{ mva.description }}"></i> 
                    {{ mva.description }}
                {% elif 'no known' in mva.description %}
                    <i class="fas fa-times-circle icon-red" title="{{ mva.description }}"></i> 
                    {{ mva.description }}
                {% else %}
                    {{ mva.description }}
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Pagination Controls -->
<nav aria-label="Page navigation">
    <ul class="pagination">
        {% if mva_records.has_prev %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('view_mva_data', page=1, first_name=request.args.get('first_name', ''), last_name=request.args.get('last_name', ''), school_name=request.args.get('school_name', '')) }}">First</a>
        </li>
        <li class="page-item">
            <a class="page-link" href="{{ url_for('view_mva_data', page=mva_records.prev_num, first_name=request.args.get('first_name', ''), last_name=request.args.get('last_name', ''), school_name=request.args.get('school_name', '')) }}">Previous</a>
        </li>
        {% endif %}

        {% if start_page > 1 %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('view_mva_data', page=1, first_name=request.args.get('first_name', ''), last_name=request.args.get('last_name', ''), school_name=request.args.get('school_name', '')) }}">1</a>
        </li>
        {% if start_page > 2 %}
        <li class="page-item disabled"><span class="page-link">...</span></li>
        {% endif %}
        {% endif %}

        {% for page_num in range(start_page, end_page + 1) %}
        <li class="page-item {% if page_num == mva_records.page %}active{% endif %}">
            <a class="page-link" href="{{ url_for('view_mva_data', page=page_num, first_name=request.args.get('first_name', ''), last_name=request.args.get('last_name', ''), school_name=request.args.get('school_name', '')) }}">{{ page_num }}</a>
        </li>
        {% endfor %}

        {% if end_page < mva_records.pages %}
        {% if end_page < mva_records.pages - 1 %}
        <li class="page-item disabled"><span class="page-link">...</span></li>
        {% endif %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('view_mva_data', page=mva_records.pages, first_name=request.args.get('first_name', ''), last_name=request.args.get('last_name', ''), school_name=request.args.get('school_name', '')) }}">{{ mva_records.pages }}</a>
        </li>
        {% endif %}

        {% if mva_records.has_next %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('view_mva_data', page=mva_records.next_num, first_name=request.args.get('first_name', ''), last_name=request.args.get('last_name', ''), school_name=request.args.get('school_name', '')) }}">Next</a>
        </li>
        <li class="page-item">
            <a class="page-link" href="{{ url_for('view_mva_data', page=mva_records.pages, first_name=request.args.get('first_name', ''), last_name=request.args.get('last_name', ''), school_name=request.args.get('school_name', '')) }}">Last</a>
        </li>
        {% endif %}
    </ul>
</nav>
{% endblock %} 